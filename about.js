import { supabase } from "./supabase.js";

async function checkUser() {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = "login.html";
  } else {
    console.log("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:", user.email);
  }
}

checkUser();

window.openMenu = function () {
  document.getElementById("sideMenu").classList.add("open");
};
window.closeMenu = function () {
  document.getElementById("sideMenu").classList.remove("open");
};


    // ØªØºÙŠÙŠØ± ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ù„ÙŠ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
document.addEventListener("DOMContentLoaded", () => {
  const userType = localStorage.getItem("userType"); // "donor", "hospital", "bloodbank"

  const linkText = (userType === "hospital" || userType === "bloodbank")
    ? "Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†"
    : "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©";

  const linkHref = (userType === "hospital" || userType === "bloodbank")
    ? "donate_card.html"
    : "emergency_card.html";

  const linkHTML = `<a href="${linkHref}">${linkText}</a>`;

  // ØªØ¹ÙˆÙŠØ¶ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
  const placeholders = [
    document.getElementById("requestsLinkPlaceholder"),
    document.getElementById("requestsLinkDesktop"),
    document.getElementById("requestsLinkMobile")
  ];

  placeholders.forEach(placeholder => {
    if (placeholder) {
      placeholder.outerHTML = linkHTML;
    }
  });
});

// ğŸ”¹ ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Supabase ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
document.addEventListener("DOMContentLoaded", async () => {
  const { data: { session } } = await supabase.auth.getSession();

  const authButtons = document.getElementById("authButtons");
  const sideAuthButtons = document.getElementById("sideAuthButtons");
  const profileLink = document.getElementById("profileLink");
  const profileLinkMobile = document.getElementById("profileLinkMobile");

  if (session) {
    const userId = session.user.id;
    const { data: profile, error } = await supabase
      .from('login')
      .select('*')
      .eq('id', userId)
      .single();

    if (profile) {
      // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
      if (authButtons) authButtons.style.display = "none";
      if (sideAuthButtons) sideAuthButtons.style.display = "none";

      // Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© "Ù…Ù„ÙÙŠ"
      if (profileLink) {
        profileLink.style.display = "inline-block";
        profileLink.textContent = "Ù…Ù„ÙÙŠ";
      }
      if (profileLinkMobile) {
        profileLinkMobile.style.display = "inline-block";
        profileLinkMobile.textContent = "Ù…Ù„ÙÙŠ";
      }
    }
  }
});
